name: get windows iso
run-name: ${{ github.actor }} GitHub Actions get windows11 iso
on:
  workflow_dispatch:
    inputs:
      UPLOAD_BIN_DIR:
        description: '保存到Artifacts'
        type: boolean
        default: false
        required: false
      UUID_ID:
        description: 'UUDID'
        type: string
        default: "fcd8b9e8-d093-465a-bf2d-ae5e547de015"
        required: false

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest # windows-latest # For Linux, use ubuntu-latest
    steps:
    - name: 'Checkout GitHub Action'
      uses: actions/checkout@v3

    - name: 'Init System'
      run: |
        sudo apt-get install aria2 cabextract wimtools chntpw genisoimage -y

    - name: 'Run UUP Dump'
      run: |

        chmod +x *.sh && ./uup_download_linux.sh ${{ inputs.UUID_ID }}
        tar czf - *.ISO | split -b 1980m - meiso.tar.gz_
        mkdir isoBin && mv *.ISO isoBin

    - name: Upload ISO To Artifact
      uses: actions/upload-artifact@main
      if: inputs.UPLOAD_BIN_DIR == true && !cancelled()
      with:
        name: isoBin
        path: isoBin

    - name: Upload ISO To WeTransfer
      id: wetransfer
      if: (!cancelled())
      run: |
        curl -fsSL git.io/file-transfer | sh
        find meiso.tar.gz_* | xargs -I{} ./transfer wet -s -p 16 --no-progress {} 2>&1 | tee wetransfer.log | \
        xargs echo -e "::warning file=wetransfer.com::$(cat wetransfer.log | grep https)\n"
